# =============================================================================
# RAG AI Chatbot - Environment Configuration Example
# =============================================================================
# Copy this file to .env and customize values as needed
# =============================================================================

# -----------------------------------------------------------------------------
# LLM Provider Settings
# -----------------------------------------------------------------------------
# Provider options: lmstudio, ollama, openai
# - lmstudio: Use remote LM Studio (via ngrok or local)
# - ollama: Use containerized Ollama (requires --profile ollama)
# - openai: Use OpenAI API
LLM__PROVIDER=lmstudio

# LM Studio settings (remote via ngrok or local)
# For remote LM Studio on another PC, use your ngrok URL:
LLM__LMSTUDIO__BASE_URL=https://your-ngrok-url.ngrok-free.app/v1
LLM__LMSTUDIO__MODEL=deepseek-coder-v2-lite-instruct

# Ollama settings (containerized - only used with --profile ollama)
LLM__OLLAMA__BASE_URL=http://ollama:11434
LLM__OLLAMA__MODEL=mistral:latest

# OpenAI settings (if using OpenAI)
LLM__OPENAI__BASE_URL=https://api.openai.com/v1
LLM__OPENAI__MODEL=gpt-4o-mini
LLM__OPENAI__API_KEY=

# Common LLM settings
LLM__TEMPERATURE=0.35
LLM__MAX_TOKENS=4096
LLM__TIMEOUT=120.0
LLM__CONTEXT_WINDOW=8000

# -----------------------------------------------------------------------------
# Embedding Provider Settings
# -----------------------------------------------------------------------------
# Options: lmstudio, ollama
# - lmstudio: Use LM Studio for embeddings (default when LLM__PROVIDER=lmstudio)
# - ollama: Use Ollama for embeddings (requires --profile ollama)
EMBEDDING_PROVIDER=lmstudio
EMBEDDING_MODEL=text-embedding-nomic-embed-text-v1.5

# -----------------------------------------------------------------------------
# RAG / Vector Store Settings
# -----------------------------------------------------------------------------
RAG__PROVIDER=chromadb
RAG__CHROMA_DB_PATH=./data/chroma
RAG__EMBEDDING_MODEL=nomic-embed-text

# -----------------------------------------------------------------------------
# Small Model RAG Optimization Settings
# -----------------------------------------------------------------------------
# Cross-encoder reranker for better retrieval quality
RAG__RERANKER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
RAG__RERANKER_ENABLED=true

# Retrieval settings
RAG__INITIAL_FETCH_K=30        # Fetch more candidates for reranking
RAG__RERANK_TOP_K=5            # Keep top K after reranking
RAG__MMR_LAMBDA=0.5            # MMR diversity (0=max diversity, 1=max relevance)

# Context budget (token limit for retrieved context)
RAG__CONTEXT_TOKEN_BUDGET=1000

# Evidence thresholds
RAG__MIN_CONFIDENCE_THRESHOLD=0.3  # Below this, add uncertainty disclaimer

# -----------------------------------------------------------------------------
# Hybrid Search Settings (BM25 + Vector)
# -----------------------------------------------------------------------------
# Combines keyword (BM25) and semantic (vector) search for better factual lookups
RAG__BM25_ENABLED=true
RAG__BM25_WEIGHT=0.4           # Weight for BM25 in RRF fusion (0-1)
RAG__VECTOR_WEIGHT=0.6         # Weight for vector search in RRF fusion (0-1)
RAG__BM25_PERSIST_PATH=./data/bm25

# -----------------------------------------------------------------------------
# Knowledge Graph Settings
# -----------------------------------------------------------------------------
# Per-client knowledge graph for entity disambiguation and multi-hop reasoning
RAG__KNOWLEDGE_GRAPH_ENABLED=true
RAG__KG_EXPANSION_DEPTH=2      # How many relationship hops to traverse
RAG__KG_PERSIST_PATH=./data/knowledge_graphs
RAG__ENTITY_EXTRACTION_MODEL=mistral:latest  # Model for entity extraction

# -----------------------------------------------------------------------------
# Chunking Settings
# -----------------------------------------------------------------------------
# Controls how documents are split into chunks for retrieval
RAG__CHUNK_TOKEN_SIZE=512      # Target chunk size in tokens
RAG__CHUNK_TOKEN_OVERLAP=128   # Overlap between consecutive chunks
RAG__MIN_CHUNK_TOKENS=50       # Minimum chunk size to avoid tiny fragments
RAG__RESPECT_HEADINGS=true     # Attempt to chunk along heading boundaries

# -----------------------------------------------------------------------------
# Answer Verification & Citation Settings
# -----------------------------------------------------------------------------
# Ensures answers are grounded in retrieved context
RAG__VERIFICATION_ENABLED=true
RAG__CITATION_REQUIRED=true    # Require citations in responses
RAG__MIN_CITATION_COVERAGE=0.7 # 70% of factual claims should be cited

# -----------------------------------------------------------------------------
# Pipeline Gating Settings (Performance Optimization)
# -----------------------------------------------------------------------------
# Skip unnecessary pipeline stages based on query intent and confidence
RAG__SKIP_RETRIEVAL_FOR_CHITCHAT=true   # Skip RAG for chitchat intents
RAG__CONFIDENCE_GATING_ENABLED=true     # Skip rerank/verify when confidence high
RAG__KG_EXPANSION_GATING=true           # Only expand KG when recall is low

# -----------------------------------------------------------------------------
# Session / Memory Settings
# -----------------------------------------------------------------------------
SESSION__MAX_TOKENS=2500
SESSION__MAX_MESSAGES=15

# Sliding window settings (small model optimization)
SESSION__SLIDING_WINDOW_TURNS=3      # Keep only last N turns in context
SESSION__EPISODIC_MEMORY_ENABLED=true  # Extract important decisions/facts
SESSION__RUNNING_SUMMARY_ENABLED=true  # Summarize older history

# -----------------------------------------------------------------------------
# Redis Settings
# -----------------------------------------------------------------------------
REDIS__URL=redis://localhost:6379
REDIS__SESSION_TTL=86400  # 24 hours
REDIS__CACHE_TTL=3600     # 1 hour

# -----------------------------------------------------------------------------
# MySQL Settings (Audit Logging)
# -----------------------------------------------------------------------------
MYSQL__HOST=localhost
MYSQL__PORT=3306
MYSQL__DATABASE=audit_logs
MYSQL__USER=root
MYSQL__PASSWORD=your_password_here
MYSQL__POOL_SIZE=5

# -----------------------------------------------------------------------------
# JWT Authentication Settings
# -----------------------------------------------------------------------------
JWT__SECRET_KEY=change-me-in-production-use-strong-secret
JWT__ALGORITHM=HS256
JWT__ACCESS_TOKEN_EXPIRE_MINUTES=30

# -----------------------------------------------------------------------------
# Server Settings
# -----------------------------------------------------------------------------
SERVER__HOST=0.0.0.0
SERVER__PORT=8000

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
LOGGING__LEVEL=INFO
LOGGING__LOG_DIR=./logs
LOGGING__JSON_FORMAT=true

# -----------------------------------------------------------------------------
# Evaluation Settings
# -----------------------------------------------------------------------------
EVALUATION__SCHEDULER_ENABLED=true

# -----------------------------------------------------------------------------
# Monitoring Settings
# -----------------------------------------------------------------------------
MONITORING__METRICS_ENABLED=true
