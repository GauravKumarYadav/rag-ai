# RAG AI Microservices Configuration
# ===================================
# Copy this file to .env and customize as needed

# ============================================================
# LLM CONFIGURATION
# ============================================================

# LLM Provider: lmstudio (using host LM Studio)
LLM__PROVIDER=lmstudio

# LM Studio settings (host.docker.internal to reach host from container)
LLM__LMSTUDIO__BASE_URL=http://host.docker.internal:1234/v1
LLM__LMSTUDIO__MODEL=openai/gpt-oss-20b

# LLM parameters
LLM__TEMPERATURE=0.25
LLM__MAX_TOKENS=4096

# ============================================================
# EMBEDDING CONFIGURATION
# ============================================================

# Embedding settings (using LM Studio)
RAG__EMBEDDING_PROVIDER=lmstudio
RAG__EMBEDDING_MODEL=text-embedding-nomic-embed-text-v1.5

# Embedding service URL (microservices mode)
EMBEDDING_SERVICE_URL=http://embedding-service:8000

# ============================================================
# VECTOR STORE (ChromaDB)
# ============================================================

# Use ChromaDB server instead of embedded
RAG_PROVIDER=chromadb
RAG_URL=http://chromadb:8000

# ============================================================
# RAG QUALITY SETTINGS (NEW)
# ============================================================

# Reranker for better retrieval
RAG__RERANKER_ENABLED=true
RAG__RERANKER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
RAG__INITIAL_FETCH_K=30
RAG__RERANK_TOP_K=5

# Hybrid Search (BM25 + Vector)
RAG__BM25_ENABLED=true
RAG__BM25_WEIGHT=0.4
RAG__VECTOR_WEIGHT=0.6
RAG__BM25_PERSIST_PATH=/data/bm25

# Knowledge Graph
RAG__KNOWLEDGE_GRAPH_ENABLED=true
RAG__KG_EXPANSION_DEPTH=2
RAG__KG_PERSIST_PATH=/data/knowledge_graphs

# Answer Verification & Citation
RAG__VERIFICATION_ENABLED=true
RAG__CITATION_REQUIRED=true
RAG__MIN_CITATION_COVERAGE=0.7
RAG__MIN_CONFIDENCE_THRESHOLD=0.3
RAG__CONTEXT_TOKEN_BUDGET=1000

# ============================================================
# REDIS
# ============================================================

REDIS_URL=redis://redis:6379

# ============================================================
# MYSQL
# ============================================================

MYSQL_HOST=mysql
MYSQL_PORT=3306
MYSQL_DATABASE=audit_logs
MYSQL_USER=root
MYSQL_ROOT_PASSWORD=Sarita1!@2024_4

# ============================================================
# JWT AUTHENTICATION
# ============================================================

JWT_SECRET_KEY=change-me-in-production-use-strong-secret
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# ============================================================
# EVALUATION SCHEDULER
# ============================================================

# Disable in-process scheduler (evaluation-worker handles this)
EVALUATION_SCHEDULER_ENABLED=false

# Cron schedule for evaluation worker (2 AM UTC daily)
EVAL_CRON_SCHEDULE=0 2 * * *

# ============================================================
# DOCUMENT PROCESSING
# ============================================================

# Document worker settings
CHUNK_SIZE=1200
CHUNK_OVERLAP=200
MAX_FILE_SIZE=52428800

# ============================================================
# MONITORING
# ============================================================

# Grafana (default credentials)
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=admin

# ============================================================
# AGENTIC RAG (Multi-Agent Orchestration)
# ============================================================

# Enable agentic pipeline (disabled by default)
AGENT__ENABLED=false

# Iteration limits
AGENT__MAX_ITERATIONS=3
AGENT__MAX_CORRECTIONS=2
AGENT__MAX_SUB_QUERIES=3

# Model routing
AGENT__FAST_MODEL=llama3.2:1b
AGENT__CAPABLE_MODEL=llama3.2:1b
AGENT__USE_MODEL_ROUTING=false

# Tool settings
AGENT__TOOLS_ENABLED=true
AGENT__ALLOWED_TOOLS=calculator,datetime

# Latency budget (milliseconds)
AGENT__MAX_LATENCY_MS=15000
